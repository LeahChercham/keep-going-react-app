{"ast":null,"code":"import _objectSpread from\"C:/Users/LeahC/OneDrive/Documents/AKAD/ABSCHLUSS BAK PROJ BACH/PROJEKT/ProjectCode/keep-going-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/LeahC/OneDrive/Documents/AKAD/ABSCHLUSS BAK PROJ BACH/PROJEKT/ProjectCode/keep-going-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState,useRef,useContext}from'react';import{st as myStyles}from'./styles';import{Button}from'@mui/material';import{useDispatch,useSelector}from'react-redux';import{useLocation}from'react-router-dom';import{getOfferContacts,getOffer,offerSend,updateOffer}from'../../store/actions/offerAction';import{userGet}from'../../store/actions/authActions';import{SocketContext}from'../../socketContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Offer(props){var dispatch=useDispatch();var socket=useContext(SocketContext);var _useSelector=useSelector(function(state){return state.auth;}),loading=_useSelector.loading,authenticated=_useSelector.authenticated,error=_useSelector.error,successMessage=_useSelector.successMessage,user=_useSelector.user;var _useSelector2=useSelector(function(state){return state.offer;}),offer=_useSelector2.offer,offerContacts=_useSelector2.offerContacts,offerSendSuccess=_useSelector2.offerSendSuccess,offerGetSuccess=_useSelector2.offerGetSuccess;var myInfo=user;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),socketOffer=_useState2[0],setSocketOffer=_useState2[1];var currentContact=props.currentContact;useEffect(function(){myInfo=user;},[user]);useEffect(function(){socket.on('getOffer',function(data){// OK\ndispatch({type:'OFFER_GET_SUCCESS',payload:{offer:data}});dispatch(userGet(myInfo));});socket.on('ofrDeliveredResponse',function(ofr){dispatch({type:'DELIVERED_OFFER',payload:{offerInfo:ofr}});});},[]);useEffect(function(){if(socketOffer&&currentContact!==\"\"){var myId=myInfo.id?myInfo.id:myInfo._id;if(socketOffer.senderId===currentContact._id&&socketOffer.receiverId===myId){dispatch({type:'SOCKET_OFFER',payload:{offer:socketOffer}});}}setSocketOffer('');},[socketOffer]);var respondToOffer=function respondToOffer(response){var status;response==='accept'?status='accepted':status='declined';var myId=myInfo.id?myInfo.id:myInfo._id;var data=_objectSpread(_objectSpread({},offer),{},{status:status});dispatch(updateOffer(data)).then(function(res){dispatch(userGet(myInfo));});socket.emit('respondToOffer',{senderId:myId,askerId:offer.askerId,answererId:offer.answererId,senderName:myInfo.username,receiverId:currentContact._id,offer:{price:offer.offer.price},status:status});};return/*#__PURE__*/_jsx(\"div\",{style:myStyles.offer,children:offer!==null&&offer!==void 0&&offer.offer?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{children:offer.status===\"false\"?/*#__PURE__*/_jsx(\"span\",{children:offer.senderName===myInfo.username?/*#__PURE__*/_jsx(\"span\",{children:\"Offer send\"}):/*#__PURE__*/_jsx(\"span\",{children:\"Offer received\"})}):/*#__PURE__*/_jsx(\"span\",{children:offer.status==='accepted'?/*#__PURE__*/_jsx(\"span\",{children:\"Offer accepted\"}):/*#__PURE__*/_jsx(\"span\",{children:offer.status===\"false\"?/*#__PURE__*/_jsx(\"span\",{children:\"Offer delivered\"}):/*#__PURE__*/_jsx(\"span\",{children:\"Offer declined\"})})})}),/*#__PURE__*/_jsx(\"div\",{children:offer.status===\"false\"?offer.askerId===myInfo.id||offer.askerId===myInfo._id?/*#__PURE__*/_jsxs(\"span\",{children:[\"You will pay \",offer.offer.price,\" tokens in order for \",currentContact.username,\" to help you. \"]}):/*#__PURE__*/_jsxs(\"span\",{children:[\"You will receive \",offer.offer.price,\" tokens in order to help \",currentContact.username,\".\"]}):/*#__PURE__*/_jsx(\"span\",{children:offer.status==='declined'?/*#__PURE__*/_jsx(\"span\",{}):offer.askerId===myInfo.id||offer.askerId===myInfo._id?/*#__PURE__*/_jsxs(\"span\",{children:[\"You paid \",currentContact.username,\" \",offer.offer.price,\" tokens. \"]}):/*#__PURE__*/_jsxs(\"span\",{children:[\"You received \",offer.offer.price,\" tokens to help \",currentContact.username,\".\"]})})}),/*#__PURE__*/_jsx(\"div\",{children:offer.status===\"false\"?/*#__PURE__*/_jsx(\"span\",{children:offer.senderName===myInfo.username?/*#__PURE__*/_jsx(\"span\",{children:\"... Waiting for an answer\"}):/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(Button,{onClick:function onClick(e){respondToOffer('accept');},children:\" Accept \"}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(e){respondToOffer('decline');},children:\" Decline \"})]})}):null})]}):null});}export default Offer;","map":{"version":3,"names":["React","useEffect","useState","useRef","useContext","st","myStyles","Button","useDispatch","useSelector","useLocation","getOfferContacts","getOffer","offerSend","updateOffer","userGet","SocketContext","Offer","props","dispatch","socket","state","auth","loading","authenticated","error","successMessage","user","offer","offerContacts","offerSendSuccess","offerGetSuccess","myInfo","socketOffer","setSocketOffer","currentContact","on","data","type","payload","ofr","offerInfo","myId","id","_id","senderId","receiverId","respondToOffer","response","status","then","res","emit","askerId","answererId","senderName","username","price","e"],"sources":["C:/Users/LeahC/OneDrive/Documents/AKAD/ABSCHLUSS BAK PROJ BACH/PROJEKT/ProjectCode/keep-going-react-app/frontend/src/Components/messenger/Offer.jsx"],"sourcesContent":["import React, { useEffect, useState, useRef, useContext } from 'react'\r\nimport { st as myStyles } from './styles'\r\nimport { Button } from '@mui/material';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { getOfferContacts, getOffer, offerSend, updateOffer } from '../../store/actions/offerAction';\r\nimport { userGet } from '../../store/actions/authActions';\r\nimport { SocketContext } from '../../socketContext'\r\n\r\nfunction Offer(props) {\r\n\r\n    const dispatch = useDispatch();\r\n    const socket = useContext(SocketContext);\r\n\r\n    const { loading, authenticated, error, successMessage, user } = useSelector(state => state.auth);\r\n    const { offer, offerContacts, offerSendSuccess, offerGetSuccess } = useSelector(state => state.offer);\r\n    let myInfo = user\r\n\r\n    const [socketOffer, setSocketOffer] = useState('');\r\n    let currentContact = props.currentContact;\r\n\r\n    useEffect(() => {\r\n        myInfo = user\r\n    }, [user])\r\n\r\n    useEffect(() => {\r\n        socket.on('getOffer', (data) => { // OK\r\n            dispatch({\r\n                type: 'OFFER_GET_SUCCESS',\r\n                payload: {\r\n                    offer: data\r\n                }\r\n            })\r\n            dispatch(userGet(myInfo))\r\n\r\n        })\r\n\r\n        socket.on('ofrDeliveredResponse', ofr => {\r\n            dispatch({\r\n                type: 'DELIVERED_OFFER',\r\n                payload: {\r\n                    offerInfo: ofr\r\n                }\r\n            })\r\n        })\r\n\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (socketOffer && currentContact !== \"\") {\r\n            let myId = myInfo.id ? myInfo.id : myInfo._id\r\n            if (socketOffer.senderId === currentContact._id && socketOffer.receiverId === myId) {\r\n                dispatch({\r\n                    type: 'SOCKET_OFFER',\r\n                    payload: {\r\n                        offer: socketOffer\r\n                    }\r\n                })\r\n            }\r\n        }\r\n        setSocketOffer('')\r\n    }, [socketOffer]);\r\n\r\n    const respondToOffer = (response) => {\r\n        let status\r\n        response === 'accept' ? status = 'accepted' : status = 'declined'\r\n\r\n        let myId = myInfo.id ? myInfo.id : myInfo._id\r\n        const data = { ...offer, status: status }\r\n\r\n\r\n        dispatch(updateOffer(data)).then((res) => {\r\n\r\n            dispatch(userGet(myInfo))\r\n        })\r\n\r\n\r\n\r\n        socket.emit('respondToOffer', {\r\n            senderId: myId,\r\n            askerId: offer.askerId,\r\n            answererId: offer.answererId,\r\n            senderName: myInfo.username,\r\n            receiverId: currentContact._id,\r\n            offer: { price: offer.offer.price },\r\n            status: status,\r\n\r\n        })\r\n    }\r\n\r\n\r\n    return (<div style={myStyles.offer}>\r\n        {offer?.offer ?\r\n            <div>\r\n                <div>\r\n                    {offer.status === \"false\" ? <span>\r\n                        {offer.senderName === myInfo.username ? <span>Offer send</span>\r\n                            : <span>Offer received</span>}\r\n                    </span>\r\n                        :\r\n                        <span>\r\n                            {offer.status === 'accepted' ? <span>Offer accepted</span> :\r\n                                <span>\r\n                                    {offer.status === \"false\" ? <span>Offer delivered</span> : <span>Offer declined</span>}\r\n                                </span>\r\n                            }\r\n                        </span>}\r\n                </div>\r\n                <div>\r\n                    {offer.status === \"false\" ?\r\n                        (offer.askerId === myInfo.id || offer.askerId === myInfo._id) ? <span>You will pay {offer.offer.price} tokens in order for {currentContact.username} to help you. </span>\r\n                            : <span>You will receive {offer.offer.price} tokens in order to help {currentContact.username}.</span>\r\n                        : <span>{offer.status === 'declined' ? <span></span> :\r\n\r\n                            (offer.askerId === myInfo.id || offer.askerId === myInfo._id) ? <span>You paid {currentContact.username} {offer.offer.price} tokens. </span>\r\n                                : <span>You received {offer.offer.price} tokens to help {currentContact.username}.</span>\r\n                        }\r\n                        </span>\r\n                    }\r\n\r\n                </div>\r\n                <div>\r\n                    {offer.status === \"false\" ? <span>\r\n                        {offer.senderName === myInfo.username ? <span>... Waiting for an answer</span>\r\n                            : <span>\r\n                                <Button onClick={(e) => { respondToOffer('accept') }}> Accept </Button>\r\n                                <Button onClick={(e) => { respondToOffer('decline') }}> Decline </Button>\r\n                            </span>\r\n                        }</span>\r\n                        : null}\r\n                </div>\r\n\r\n            </div>\r\n            : null\r\n        }\r\n    </div>\r\n    )\r\n}\r\n\r\nexport default Offer;"],"mappings":"yXAAA,MAAOA,MAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,CAAqCC,MAArC,CAA6CC,UAA7C,KAA+D,OAA/D,CACA,OAASC,EAAE,GAAIC,SAAf,KAA+B,UAA/B,CACA,OAASC,MAAT,KAAuB,eAAvB,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CACA,OAASC,WAAT,KAA4B,kBAA5B,CACA,OAASC,gBAAT,CAA2BC,QAA3B,CAAqCC,SAArC,CAAgDC,WAAhD,KAAmE,iCAAnE,CACA,OAASC,OAAT,KAAwB,iCAAxB,CACA,OAASC,aAAT,KAA8B,qBAA9B,C,wFAEA,QAASC,MAAT,CAAeC,KAAf,CAAsB,CAElB,GAAMC,SAAQ,CAAGX,WAAW,EAA5B,CACA,GAAMY,OAAM,CAAGhB,UAAU,CAACY,aAAD,CAAzB,CAEA,iBAAgEP,WAAW,CAAC,SAAAY,KAAK,QAAIA,MAAK,CAACC,IAAV,EAAN,CAA3E,CAAQC,OAAR,cAAQA,OAAR,CAAiBC,aAAjB,cAAiBA,aAAjB,CAAgCC,KAAhC,cAAgCA,KAAhC,CAAuCC,cAAvC,cAAuCA,cAAvC,CAAuDC,IAAvD,cAAuDA,IAAvD,CACA,kBAAoElB,WAAW,CAAC,SAAAY,KAAK,QAAIA,MAAK,CAACO,KAAV,EAAN,CAA/E,CAAQA,KAAR,eAAQA,KAAR,CAAeC,aAAf,eAAeA,aAAf,CAA8BC,gBAA9B,eAA8BA,gBAA9B,CAAgDC,eAAhD,eAAgDA,eAAhD,CACA,GAAIC,OAAM,CAAGL,IAAb,CAEA,cAAsCzB,QAAQ,CAAC,EAAD,CAA9C,wCAAO+B,WAAP,eAAoBC,cAApB,eACA,GAAIC,eAAc,CAAGjB,KAAK,CAACiB,cAA3B,CAEAlC,SAAS,CAAC,UAAM,CACZ+B,MAAM,CAAGL,IAAT,CACH,CAFQ,CAEN,CAACA,IAAD,CAFM,CAAT,CAIA1B,SAAS,CAAC,UAAM,CACZmB,MAAM,CAACgB,EAAP,CAAU,UAAV,CAAsB,SAACC,IAAD,CAAU,CAAE;AAC9BlB,QAAQ,CAAC,CACLmB,IAAI,CAAE,mBADD,CAELC,OAAO,CAAE,CACLX,KAAK,CAAES,IADF,CAFJ,CAAD,CAAR,CAMAlB,QAAQ,CAACJ,OAAO,CAACiB,MAAD,CAAR,CAAR,CAEH,CATD,EAWAZ,MAAM,CAACgB,EAAP,CAAU,sBAAV,CAAkC,SAAAI,GAAG,CAAI,CACrCrB,QAAQ,CAAC,CACLmB,IAAI,CAAE,iBADD,CAELC,OAAO,CAAE,CACLE,SAAS,CAAED,GADN,CAFJ,CAAD,CAAR,CAMH,CAPD,EASH,CArBQ,CAqBN,EArBM,CAAT,CAuBAvC,SAAS,CAAC,UAAM,CACZ,GAAIgC,WAAW,EAAIE,cAAc,GAAK,EAAtC,CAA0C,CACtC,GAAIO,KAAI,CAAGV,MAAM,CAACW,EAAP,CAAYX,MAAM,CAACW,EAAnB,CAAwBX,MAAM,CAACY,GAA1C,CACA,GAAIX,WAAW,CAACY,QAAZ,GAAyBV,cAAc,CAACS,GAAxC,EAA+CX,WAAW,CAACa,UAAZ,GAA2BJ,IAA9E,CAAoF,CAChFvB,QAAQ,CAAC,CACLmB,IAAI,CAAE,cADD,CAELC,OAAO,CAAE,CACLX,KAAK,CAAEK,WADF,CAFJ,CAAD,CAAR,CAMH,CACJ,CACDC,cAAc,CAAC,EAAD,CAAd,CACH,CAbQ,CAaN,CAACD,WAAD,CAbM,CAAT,CAeA,GAAMc,eAAc,CAAG,QAAjBA,eAAiB,CAACC,QAAD,CAAc,CACjC,GAAIC,OAAJ,CACAD,QAAQ,GAAK,QAAb,CAAwBC,MAAM,CAAG,UAAjC,CAA8CA,MAAM,CAAG,UAAvD,CAEA,GAAIP,KAAI,CAAGV,MAAM,CAACW,EAAP,CAAYX,MAAM,CAACW,EAAnB,CAAwBX,MAAM,CAACY,GAA1C,CACA,GAAMP,KAAI,gCAAQT,KAAR,MAAeqB,MAAM,CAAEA,MAAvB,EAAV,CAGA9B,QAAQ,CAACL,WAAW,CAACuB,IAAD,CAAZ,CAAR,CAA4Ba,IAA5B,CAAiC,SAACC,GAAD,CAAS,CAEtChC,QAAQ,CAACJ,OAAO,CAACiB,MAAD,CAAR,CAAR,CACH,CAHD,EAOAZ,MAAM,CAACgC,IAAP,CAAY,gBAAZ,CAA8B,CAC1BP,QAAQ,CAAEH,IADgB,CAE1BW,OAAO,CAAEzB,KAAK,CAACyB,OAFW,CAG1BC,UAAU,CAAE1B,KAAK,CAAC0B,UAHQ,CAI1BC,UAAU,CAAEvB,MAAM,CAACwB,QAJO,CAK1BV,UAAU,CAAEX,cAAc,CAACS,GALD,CAM1BhB,KAAK,CAAE,CAAE6B,KAAK,CAAE7B,KAAK,CAACA,KAAN,CAAY6B,KAArB,CANmB,CAO1BR,MAAM,CAAEA,MAPkB,CAA9B,EAUH,CAzBD,CA4BA,mBAAQ,YAAK,KAAK,CAAE3C,QAAQ,CAACsB,KAArB,UACHA,KAAK,OAAL,EAAAA,KAAK,SAAL,EAAAA,KAAK,CAAEA,KAAP,cACG,oCACI,qBACKA,KAAK,CAACqB,MAAN,GAAiB,OAAjB,cAA2B,sBACvBrB,KAAK,CAAC2B,UAAN,GAAqBvB,MAAM,CAACwB,QAA5B,cAAuC,oCAAvC,cACK,wCAFkB,EAA3B,cAKG,sBACK5B,KAAK,CAACqB,MAAN,GAAiB,UAAjB,cAA8B,wCAA9B,cACG,sBACKrB,KAAK,CAACqB,MAAN,GAAiB,OAAjB,cAA2B,yCAA3B,cAA0D,wCAD/D,EAFR,EANR,EADJ,cAeI,qBACKrB,KAAK,CAACqB,MAAN,GAAiB,OAAjB,CACIrB,KAAK,CAACyB,OAAN,GAAkBrB,MAAM,CAACW,EAAzB,EAA+Bf,KAAK,CAACyB,OAAN,GAAkBrB,MAAM,CAACY,GAAzD,cAAgE,wCAAoBhB,KAAK,CAACA,KAAN,CAAY6B,KAAhC,yBAA4DtB,cAAc,CAACqB,QAA3E,oBAAhE,cACM,4CAAwB5B,KAAK,CAACA,KAAN,CAAY6B,KAApC,6BAAoEtB,cAAc,CAACqB,QAAnF,OAFT,cAGK,sBAAO5B,KAAK,CAACqB,MAAN,GAAiB,UAAjB,cAA8B,eAA9B,CAEJrB,KAAK,CAACyB,OAAN,GAAkBrB,MAAM,CAACW,EAAzB,EAA+Bf,KAAK,CAACyB,OAAN,GAAkBrB,MAAM,CAACY,GAAzD,cAAgE,oCAAgBT,cAAc,CAACqB,QAA/B,KAA0C5B,KAAK,CAACA,KAAN,CAAY6B,KAAtD,eAAhE,cACM,wCAAoB7B,KAAK,CAACA,KAAN,CAAY6B,KAAhC,oBAAuDtB,cAAc,CAACqB,QAAtE,OAHR,EAJV,EAfJ,cA4BI,qBACK5B,KAAK,CAACqB,MAAN,GAAiB,OAAjB,cAA2B,sBACvBrB,KAAK,CAAC2B,UAAN,GAAqBvB,MAAM,CAACwB,QAA5B,cAAuC,mDAAvC,cACK,qCACE,KAAC,MAAD,EAAQ,OAAO,CAAE,iBAACE,CAAD,CAAO,CAAEX,cAAc,CAAC,QAAD,CAAd,CAA0B,CAApD,sBADF,cAEE,KAAC,MAAD,EAAQ,OAAO,CAAE,iBAACW,CAAD,CAAO,CAAEX,cAAc,CAAC,SAAD,CAAd,CAA2B,CAArD,uBAFF,GAFkB,EAA3B,CAOK,IARV,EA5BJ,GADH,CAyCK,IA1CF,EAAR,CA8CH,CAED,cAAe9B,MAAf"},"metadata":{},"sourceType":"module"}